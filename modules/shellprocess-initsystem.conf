dontChroot: false

script:
  # When test, chroot environment didn't have root
  - command: "groupadd -g 0 root"
  - command: "useradd -g root -u 0 root"
#else#  - command: "useradd -s /bin/bash -g root -u 0 -Md /root root"
# create apt user - might only create `nogroup` and reconfigure apt but it is not yet installed (?)
  - command: "groupadd -fg 65534 nogroup"
  - command: "useradd -s /usr/sbin/nologin -u 100 -g 65534 -Md /nonexistent _apt"
  # Use update-alternative to set awk as mawk, so locales can be installed
  - command: "update-alternatives --install /usr/bin/awk awk /usr/bin/mawk 0"
  - command: "ln -sfv /usr/share/keyrings/parrot-archive-keyring.gpg /etc/apt/trusted.gpg.d/"
  # Packages passwd, locales, ca-certificates are included in live mode.
  - command: "-apt install passwd locales ca-certificates -y"
    timeout: 720
  # Refresh index file (assume the source list is fine)
  - command: "echo \"deb https://deb.parrot.sh/parrot parrot main contrib non-free\" > /etc/apt/sources.list.d/parrot.list"
  - command: "-apt update"
    timeout: 720
  # Packages require repository. Need to do update indexes first
  # Some packages might complain missing `kmod`. However, we do not install it by default
  - command: "-apt install -y sudo dbus ssl-cert"
    timeout: 720
  # In the end, system requires linux-image-amd64 and systemd-sysv to work
  # but that will be selectable
