dontChroot: false

i18n:
  name: "Initializing NetInst System"
script:
  # When test, chroot environment didn't have root
  - command: "groupadd -fg 0 root"
  - command: "useradd -Md /root -g root -u 0 root"
  # Add group /nonexistent for _apt
  - command: "groupadd -fg 65534 nogroup"
  # Use update-alternative to set awk as mawk, so locales can be installed
  - command: "update-alternatives --install /usr/bin/awk awk /usr/bin/mawk 0"
  - command: "ln -sfv /usr/share/keyrings/parrot-archive-keyring.gpg /etc/apt/trusted.gpg.d/"

  # Packages passwd, locales, ca-certificates are included in live mode.
  - command: "-apt install passwd locales ca-certificates -y"
    timeout: 360
  # Refresh index file (assume the source list is fine)
  # TODO replace this step by source-media
  - command: "echo \"deb https://deb.parrot.sh/parrot parrot main contrib non-free\" > /etc/apt/sources.list.d/parrot.list"
  # Packages require repository. Need to do update indexes first
  - command: "-apt update"
    timeout: 360
  # Add group dip and utmp so we can install network-manager
  ##- command: "addgroup -fg 30 dip"
  ##- command: "addgroup -fg 43 utmp"
  # Add group mail to install base-files
  ##- command: "addgroup -fg 8 mail"
  ##- command: "addgroup -fg 50 staff"
  # Some packages might complain missing `kmod`. However, we do not install it by default
  - command: "-apt install -y ssl-cert sudo dbus kmod iproute2 ifupdown"
    timeout: 360
  # FIXME: need config utf8 in charmpa of console setup https://unix.stackexchange.com/a/424666
  ##- command: "-DEBIAN_FRONTEND=noninteractive apt install keyboard-configuration console-setup -y"
  ##  timeout: 360
  # Generate machine id
  - command: "/usr/bin/dbus-uuidgen --ensure=/etc/machine-id"
  - command: "/usr/bin/dbus-uuidgen --ensure"
